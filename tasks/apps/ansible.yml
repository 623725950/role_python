- name: Install Ansible and exra modules
  pip:
    name: [requests,docker,PyMySQL,psycopg2-binary]
    executable: pip3

- block:
  - name: Get ansible cli
    stat: path=/usr/bin/ansible
    register: ansible_stat

  - name: Check whether ansible exists
    fail:
      msg: "ansible was not install successful"
    when: not ansible_stat.stat.exists

- name: Open Internet access
  lineinfile:
      dest: "/etc/ansible/ansible.cfg"
      regexp: "#log_path = /var/log/ansible.log"
      line: "log_path = /data/apps/ansible/ansible.log"

- name: Run ansible cli for create log file
  shell: ansible --version

- name: Create link for ansible
  file:
    src: '{{item.src}}'
    dest: '{{item.dest}}'
    state: link
  with_items:
    - {src: /etc/ansible/ansible.cfg,dest: /data/config/ansible.cfg}
    - {src: /data/apps/ansible/ansible.log,dest: /data/logs/ansible}

- name: Check ansible version
  shell: sudo echo $(ansible  --version |sed -n 1p) |sudo tee -a /data/logs/install_version.txt